@if (!string.IsNullOrEmpty(Message))
{
    <div class="chat-bubble-container">
        <div class="mascot-wrapper">
            <div class="cake-character">
                <div class="sparkle"></div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>

                <div class="candles-container">
                    <div class="candle"><div class="flame"></div></div>
                    <div class="candle"><div class="flame"></div></div>
                    <div class="candle"><div class="flame"></div></div>
                </div>

                <div class="cake-top"></div>
                <div class="cake-middle"></div>
                <div class="cake-bottom">
                    <div class="cake-stripe"></div>
                    <div class="cake-stripe"></div>
                </div>
                <div class="cake-base"></div>

                <div class="face">
                    <div class="eyes">
                        <div class="eyebrow left"></div>
                        <div class="eyebrow right"></div>
                        <div class="eye">
                            <div class="pupil"><div class="highlight"></div></div>
                        </div>
                        <div class="eye">
                            <div class="pupil"><div class="highlight"></div></div>
                        </div>
                    </div>
                    <div class="mouth"><div class="tongue"></div></div>
                </div>

                <div class="arm left">
                    <div class="hand left"><div class="thumb left"></div></div>
                </div>
                <div class="arm right">
                    <div class="hand right"><div class="thumb right"></div></div>
                </div>

                <div class="legs-container">
                    <div class="leg left"><div class="shoe"></div></div>
                    <div class="leg right"><div class="shoe"></div></div>
                </div>
            </div>
        </div>
        <div class="speech-bubble">
            @if (!string.IsNullOrEmpty(Title))
            {
                <h3 class="bubble-title">@Title</h3>
            }
            <p class="bubble-message">@Message</p>
        </div>
        @if (!string.IsNullOrEmpty(AudioFile))
        {
            <audio autoplay class="bubble-audio">
                <source src="@AudioFile" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        }
    </div>
}

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public string Message { get; set; } = string.Empty;
    [Parameter] public string? AudioFile { get; set; }
}

<style>
    .chat-bubble-container {
        display: flex;
        align-items: flex-start;
        gap: 20px;
        margin: 20px 0;
        padding: 20px;
        animation: fadeIn 0.5s ease-in-out;
    }

    .mascot-wrapper {
        flex-shrink: 0;
        transform: scale(0.55) scaleX(-1);
        transform-origin: top center;
        width: 130px;
        height: 200px;
        margin-right: -20px;
    }

    .cake-character {
        position: relative;
        animation: bounce 2s ease-in-out infinite;
    }

    @@keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0) rotate(0deg); }
        40% { transform: translateY(-10px) rotate(-2deg); }
        60% { transform: translateY(-5px) rotate(2deg); }
    }

    /* Candles */
    .candles-container {
        position: absolute;
        top: -35px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
    }

    .candle {
        width: 14px;
        height: 45px;
        background: #40E0D0;
        border-radius: 4px 4px 0 0;
        position: relative;
        animation: candleWiggle 2s ease-in-out infinite;
        border: 3px solid #000;
        border-bottom: none;
    }

    .candle:nth-child(1) { animation-delay: 0s; }
    .candle:nth-child(2) { animation-delay: 0.2s; }
    .candle:nth-child(3) { animation-delay: 0.4s; }

    @@keyframes candleWiggle {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-3deg); }
        75% { transform: rotate(3deg); }
    }

    .flame {
        position: absolute;
        top: -18px;
        left: 50%;
        transform: translateX(-50%);
        width: 18px;
        height: 24px;
        background: #FF69B4;
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: flicker 0.3s ease-in-out infinite alternate;
        border: 2px solid #FF1493;
    }

    @@keyframes flicker {
        0% { transform: translateX(-50%) scale(1) translateY(0); }
        100% { transform: translateX(-50%) scale(1.1) translateY(-2px); }
    }

    /* Cake Layers */
    .cake-top {
        width: 200px;
        height: 55px;
        background: #FF69B4;
        border-radius: 100px 100px 0 0;
        position: relative;
        border: 4px solid #000;
        box-shadow: inset 0 -5px 0 rgba(0,0,0,0.1);
    }

    .cake-middle {
        width: 200px;
        height: 50px;
        background: #E6B3FF;
        position: relative;
        border-left: 4px solid #000;
        border-right: 4px solid #000;
        margin-top: -4px;
    }

    .cake-bottom {
        width: 200px;
        height: 55px;
        background: #FFEB99;
        position: relative;
        border-left: 4px solid #000;
        border-right: 4px solid #000;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        padding: 8px 0;
    }

    .cake-stripe {
        width: 100%;
        height: 12px;
        background: #00CED1;
        border-top: 3px solid #000;
        border-bottom: 3px solid #000;
    }

    .cake-base {
        width: 200px;
        height: 25px;
        background: #FFE5B4;
        border-radius: 0 0 20px 20px;
        border: 4px solid #000;
        border-top: none;
        box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    /* Face */
    .face {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
    }

    .eyes {
        display: flex;
        gap: 30px;
        margin-bottom: 5px;
        animation: blink 4s infinite;
        position: relative;
    }

    @@keyframes blink {
        0%, 49%, 51%, 100% { transform: scaleY(1); }
        50% { transform: scaleY(0.1); }
    }

    .eyebrow {
        position: absolute;
        width: 32px;
        height: 8px;
        background: #000;
        border-radius: 50%;
        top: -10px;
    }

    .eyebrow.left { left: 0; }
    .eyebrow.right { right: 0; }

    .eye {
        width: 32px;
        height: 36px;
        background: white;
        border: 4px solid #000;
        border-radius: 50%;
        position: relative;
    }

    .pupil {
        width: 16px;
        height: 16px;
        background: #000;
        border-radius: 50%;
        position: absolute;
        top: 55%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: lookAround 5s ease-in-out infinite;
    }

    @@keyframes lookAround {
        0%, 100% { transform: translate(-50%, -50%); }
        25% { transform: translate(-30%, -50%); }
        50% { transform: translate(-50%, -40%); }
        75% { transform: translate(-70%, -50%); }
    }

    .highlight {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        position: absolute;
        top: 4px;
        left: 4px;
    }

    .mouth {
        width: 50px;
        height: 30px;
        border: 4px solid #000;
        border-top: none;
        border-radius: 0 0 50px 50px;
        background: #000;
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        animation: smile 2s ease-in-out infinite;
    }

    @@keyframes smile {
        0%, 100% { width: 50px; height: 30px; }
        50% { width: 55px; height: 32px; }
    }

    .tongue {
        width: 25px;
        height: 15px;
        background: #FF1493;
        border-radius: 50%;
        position: absolute;
        bottom: 2px;
        left: 50%;
        transform: translateX(-50%);
        border: 2px solid #C71585;
    }

    /* Arms */
    .arm {
        position: absolute;
        width: 70px;
        height: 18px;
        background: #000;
        border-radius: 12px;
        top: 65px;
    }

    .arm.left {
        left: -60px;
        transform-origin: right center;
        animation: waveLeft 1.5s ease-in-out infinite;
    }

    .arm.right {
        right: -60px;
        transform-origin: left center;
        animation: waveRight 1.5s ease-in-out infinite;
    }

    @@keyframes waveLeft {
        0%, 100% { transform: rotate(-20deg); }
        50% { transform: rotate(-50deg); }
    }

    @@keyframes waveRight {
        0%, 100% { transform: rotate(20deg); }
        50% { transform: rotate(50deg); }
    }

    .hand {
        position: absolute;
        width: 35px;
        height: 35px;
        background: white;
        border: 4px solid #000;
        border-radius: 50%;
        top: -8px;
    }

    .hand.left { left: -20px; }
    .hand.right { right: -20px; }

    .thumb {
        position: absolute;
        width: 16px;
        height: 22px;
        background: white;
        border: 4px solid #000;
        border-radius: 10px;
        top: -8px;
    }

    .thumb.left {
        left: -12px;
        transform: rotate(-30deg);
    }
    .thumb.right {
        right: -12px;
        transform: rotate(30deg);
    }

    /* Legs */
    .legs-container {
        position: absolute;
        bottom: -65px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 35px;
    }

    .leg {
        width: 18px;
        height: 50px;
        background: #000;
        border-radius: 10px;
        position: relative;
    }

    .leg.left { animation: kickLeft 1s ease-in-out infinite; }
    .leg.right { animation: kickRight 1s ease-in-out infinite; }

    @@keyframes kickLeft {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(-10deg); }
    }

    @@keyframes kickRight {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(10deg); }
    }

    .shoe {
        position: absolute;
        bottom: -12px;
        left: -12px;
        width: 40px;
        height: 20px;
        background: white;
        border: 4px solid #000;
        border-radius: 20px;
    }

    /* Confetti */
    .sparkle {
        position: absolute;
        width: 12px;
        height: 20px;
        animation: confettiFall 3s ease-in-out infinite;
    }

    .sparkle:nth-child(1) {
        top: -25px;
        left: -50px;
        animation-delay: 0s;
        background: #FF69B4;
        transform: rotate(15deg);
    }

    .sparkle:nth-child(2) {
        top: 35px;
        left: -60px;
        animation-delay: 0.5s;
        background: #FFD700;
        transform: rotate(-25deg);
    }

    .sparkle:nth-child(3) {
        top: -25px;
        right: -50px;
        animation-delay: 1s;
        background: #00CED1;
        transform: rotate(45deg);
    }

    .sparkle:nth-child(4) {
        top: 35px;
        right: -60px;
        animation-delay: 1.5s;
        background: #E6B3FF;
        transform: rotate(-15deg);
    }

    @@keyframes confettiFall {
        0% {
            transform: translateY(0px) rotate(0deg);
            opacity: 0;
        }
        20% {
            opacity: 1;
        }
        50% {
            transform: translateY(30px) rotate(180deg);
            opacity: 1;
        }
        80% {
            opacity: 1;
        }
        100% {
            transform: translateY(0px) rotate(360deg);
            opacity: 0;
        }
    }

    /* Speech Bubble - New Style */
    .speech-bubble {
        background: white;
        padding: 25px 30px;
        border-radius: 25px;
        border: 5px solid #000;
        max-width: 600px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        position: relative;
        margin-left: 20px;
    }

    .speech-bubble::after {
        content: '';
        position: absolute;
        left: -25px;
        top: 30px;
        width: 0;
        height: 0;
        border-top: 15px solid transparent;
        border-bottom: 15px solid transparent;
        border-right: 30px solid white;
    }

    .speech-bubble::before {
        content: '';
        position: absolute;
        left: -35px;
        top: 25px;
        width: 0;
        height: 0;
        border-top: 20px solid transparent;
        border-bottom: 20px solid transparent;
        border-right: 37px solid #000;
        z-index: -1;
    }

    .bubble-title {
        font-family: 'Pacifico', cursive;
        color: #667eea;
        margin-bottom: 10px;
        font-size: 1.5rem;
    }

    .bubble-message {
        font-family: 'Poppins', sans-serif;
        color: #333;
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .bubble-audio {
        display: none;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
